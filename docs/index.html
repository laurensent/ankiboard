<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ankiboard</title>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0d0d0d;
      --card: #1a1a1a;
      --text: #ffffff;
      --text-dim: #888888;
      --text-muted: #555555;
      --accent: #4ade80;
      --orange: #fb923c;
      --gray-1: #2a2a2a;
      --green-1: #0e4429;
      --green-2: #006d32;
      --green-3: #26a641;
      --green-4: #4ade80;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'JetBrains Mono', monospace; background: var(--bg); color: var(--text); min-height: 100vh; padding: 40px 20px; }
    .container { max-width: 720px; margin: 0 auto; }
    .header { margin-bottom: 24px; }
    .logo { font-size: 2.5rem; font-weight: 700; letter-spacing: -1px; }
    .logo a { color: var(--text); text-decoration: none; }
    .logo a:hover { opacity: 0.8; }
    .badges { display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 20px; }
    .badge { display: inline-flex; font-size: 0.6rem; border-radius: 4px; overflow: hidden; }
    .badge-label { padding: 4px 6px; background: #333; color: var(--text-dim); }
    .badge-value { padding: 4px 6px; font-weight: 500; }
    .badge-blue .badge-value { background: #2563eb; color: #fff; }
    .badge-purple .badge-value { background: #7c3aed; color: #fff; }
    .badge-green .badge-value { background: #16a34a; color: #fff; }
    .badge-orange .badge-value { background: #ea580c; color: #fff; }
    .badge-red .badge-value { background: #dc2626; color: #fff; }
    .card { background: var(--card); border-radius: 8px; padding: 20px; }
    .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 12px; }
    .grid-3 .card { min-height: 120px; }
    .label { font-size: 0.65rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 4px; }
    .sublabel { font-size: 0.75rem; color: var(--text-dim); margin-bottom: 4px; }
    .value { font-size: 1.8rem; font-weight: 600; }
    .weekly-card { display: flex; flex-direction: column; }
    .weekly-card .label { margin-bottom: 4px; }
    .weekly-card .sublabel { margin-bottom: 8px; }
    .weekly-chart { display: flex; align-items: flex-end; gap: 6px; height: 60px; flex: 1; }
    .bar-num { font-size: 0.5rem; color: var(--text-muted); height: 12px; }
    .bar-num.active { color: var(--accent); }
    .bar { width: 100%; background: var(--gray-1); border-radius: 2px; min-height: 4px; }
    .bar.active { background: var(--accent); }
    .bar-label { font-size: 0.55rem; color: var(--text-muted); }
    .bar-label.today { color: var(--accent); }
    .section { margin-bottom: 12px; }
    .section-title { font-size: 0.65rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 10px; }
    .heatmap-inner { display: flex; flex-direction: column; }
    .heatmap-months { display: flex; margin-left: 28px; margin-bottom: 4px; }
    .heatmap-months span { font-size: 0.55rem; color: var(--text-muted); flex-shrink: 0; }
    .heatmap-body { display: flex; }
    .heatmap-days { display: flex; flex-direction: column; margin-right: 4px; flex-shrink: 0; }
    .heatmap-days span { font-size: 0.55rem; color: var(--text-muted); text-align: right; width: 22px; flex: 1; display: flex; align-items: center; justify-content: flex-end; }
    .heatmap-grid { display: grid; grid-template-columns: repeat(52, 1fr); gap: 2px; flex: 1; }
    .heatmap-week { display: grid; grid-template-rows: repeat(7, 1fr); gap: 2px; }
    .heatmap-cell { aspect-ratio: 1; border-radius: 2px; background: var(--gray-1); cursor: pointer; position: relative; }
    .heatmap-cell.future { background: transparent; }
    .heatmap-cell:not(.future):hover::after { content: attr(data-tip); position: absolute; bottom: calc(100% + 6px); left: 50%; transform: translateX(-50%); background: #333; border: 1px solid #444; color: var(--text); padding: 4px 8px; border-radius: 4px; font-size: 0.6rem; white-space: nowrap; z-index: 100; }
    .heatmap-cell.l1 { background: var(--green-1); }
    .heatmap-cell.l2 { background: var(--green-2); }
    .heatmap-cell.l3 { background: var(--green-3); }
    .heatmap-cell.l4 { background: var(--green-4); }
    .heatmap-legend { display: flex; justify-content: flex-start; align-items: center; gap: 3px; margin-top: 8px; margin-left: 28px; font-size: 0.55rem; color: var(--text-muted); }
    .legend-cell { width: 10px; height: 10px; border-radius: 2px; background: var(--gray-1); }
    .legend-cell.l1 { background: var(--green-1); }
    .legend-cell.l2 { background: var(--green-2); }
    .legend-cell.l3 { background: var(--green-3); }
    .legend-cell.l4 { background: var(--green-4); }
    .top-deck-list { display: grid; grid-template-columns: repeat(2, 1fr); grid-auto-flow: column; grid-template-rows: repeat(3, 1fr); gap: 10px 24px; }
    .top-deck-item { display: flex; align-items: center; gap: 6px; position: relative; cursor: default; }
    .top-deck-item:hover::after { content: attr(data-tip); position: absolute; bottom: calc(100% + 6px); left: 50%; transform: translateX(-50%); background: #333; border: 1px solid #444; color: var(--text); padding: 4px 8px; border-radius: 4px; font-size: 0.6rem; white-space: nowrap; z-index: 100; }
    .rank { font-size: 0.7rem; font-weight: 600; color: var(--text-muted); width: 14px; }
    .deck-name { font-size: 0.7rem; color: var(--text); }
    .bar-col { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 4px; position: relative; cursor: default; }
    .bar-col:hover::after { content: attr(data-tip); position: absolute; bottom: calc(100% + 6px); left: 50%; transform: translateX(-50%); background: #333; border: 1px solid #444; color: var(--text); padding: 4px 8px; border-radius: 4px; font-size: 0.6rem; white-space: nowrap; z-index: 100; }
    .deck-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
    .deck-item { background: var(--card); border-radius: 6px; padding: 14px; display: flex; flex-direction: column; gap: 6px; position: relative; cursor: default; }
    .deck-item:hover::after { content: attr(data-tip); position: absolute; bottom: calc(100% + 6px); left: 50%; transform: translateX(-50%); background: #333; border: 1px solid #444; color: var(--text); padding: 4px 8px; border-radius: 4px; font-size: 0.6rem; white-space: nowrap; z-index: 100; }
    .deck-item .name { font-size: 0.7rem; color: var(--text); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .deck-item .stats { font-size: 1.2rem; font-weight: 600; color: var(--text); }
    .footer { margin-top: 24px; text-align: center; font-size: 0.7rem; color: var(--text-muted); }
    .footer a { color: var(--text-muted); text-decoration: none; }
    .footer a:hover { text-decoration: underline; }
    @media (max-width: 768px) { .grid-3 { grid-template-columns: 1fr; } .deck-grid { grid-template-columns: repeat(2, 1fr); } }
  </style>
</head>
<body>
  <div class="container">
    <div class="header"><h1 class="logo"><a href="https://github.com/laurensent/ankiboard">Ankiboard</a></h1></div>
    <div class="badges" id="badges"></div>
    <div class="grid-3">
      <div class="card">
        <div class="label">Last Study</div>
        <div class="sublabel" id="last-study-date">--</div>
        <div class="value" id="days-ago">--</div>
      </div>
      <div class="card">
        <div class="label">Streak</div>
        <div class="sublabel">Consecutive Days</div>
        <div class="value" id="streak-value">--</div>
      </div>
      <div class="card weekly-card">
        <div class="label">Weekly Decks</div>
        <div class="sublabel" id="weekly-total">--</div>
        <div class="weekly-chart" id="weekly-chart"></div>
      </div>
    </div>
    <div class="section">
      <div class="section-title">Activity</div>
      <div class="card">
        <div class="heatmap-inner">
          <div class="heatmap-months" id="heatmap-months"></div>
          <div class="heatmap-body">
            <div class="heatmap-days"><span></span><span>Mon</span><span></span><span>Wed</span><span></span><span>Fri</span><span></span></div>
            <div class="heatmap-grid" id="heatmap"></div>
          </div>
        </div>
        <div class="heatmap-legend"><span>Less</span><span class="legend-cell"></span><span class="legend-cell l1"></span><span class="legend-cell l2"></span><span class="legend-cell l3"></span><span class="legend-cell l4"></span><span>More</span></div>
      </div>
    </div>
    <div class="section">
      <div class="section-title">Top Deck</div>
      <div class="card"><div class="top-deck-list" id="top-deck-list"></div></div>
    </div>
    <div class="section">
      <div class="section-title">All Decks</div>
      <div class="deck-grid" id="deck-list"></div>
    </div>
    <div class="footer">Made by <a href="https://github.com/laurensent">Lauren</a></div>
  </div>
  <script>
    function getDaysAgo(dateStr) {
      if (!dateStr) return { days: '--', formatted: '--' };
      const date = new Date(dateStr), today = new Date();
      today.setHours(0,0,0,0); date.setHours(0,0,0,0);
      const diff = Math.floor((today - date) / 86400000);
      if (diff === 0) return { days: 'Today', formatted: dateStr };
      if (diff === 1) return { days: '1 Day Ago', formatted: dateStr };
      return { days: `${diff} Days Ago`, formatted: dateStr };
    }
    function renderBadges(s) {
      const d = s.generated_at.slice(0,10).replace(/-/g,'--'), t = s.cards.total.toLocaleString().replace(/,/g,'_');
      const m = s.cards.total - s.cards.suspended > 0 ? Math.round(s.cards.mature / (s.cards.total - s.cards.suspended) * 100) : 0;
      document.getElementById('badges').innerHTML = `<img src="https://img.shields.io/badge/Last_Sync-${d}-blue"><img src="https://img.shields.io/badge/Total_Cards-${t}-blueviolet"><img src="https://img.shields.io/badge/Mastery-${m}%25-2ea043"><img src="https://img.shields.io/badge/Streak-${s.streak}_days-orange"><img src="https://img.shields.io/badge/Weekly_Reviews-${s.weekly_reviews||0}-e53935"><img src="https://img.shields.io/badge/Weekly_Time-${s.weekly_time_minutes||0}_min-e53935">`;
    }
    function renderWeekly(data) {
      const c = document.getElementById('weekly-chart'), days = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'], today = new Date();
      const last7 = Array.from({length:7},(_,i)=>{const d=new Date(today);d.setDate(d.getDate()-(6-i));return{date:d.toISOString().slice(0,10),day:days[d.getDay()],isToday:i===6};});
      const counts = last7.map(d=>data[d.date]||0), max = Math.max(...counts,1), total = counts.reduce((a,b)=>a+b,0);
      document.getElementById('weekly-total').textContent = total + ' Decks';
      c.innerHTML = last7.map((d,i)=>`<div class="bar-col" data-tip="${d.date}: ${counts[i]} decks"><div class="bar ${counts[i]>0?'active':''}" style="height:${counts[i]>0?Math.max(16,(counts[i]/max)*50):4}px"></div><div class="bar-label ${d.isToday?'today':''}">${d.day}</div></div>`).join('');
    }
    function renderHeatmap(data) {
      const g = document.getElementById('heatmap'), m = document.getElementById('heatmap-months');
      const today = new Date(), todayStr = today.toISOString().slice(0,10);
      const dataMap = {};
      data.forEach(d => dataMap[d.date] = d.count);
      const daysSinceSun = (today.getDay() + 7) % 7;
      const startDate = new Date(today);
      startDate.setDate(today.getDate() - daysSinceSun - 51 * 7);
      const weeks = [];
      for (let w = 0; w < 52; w++) {
        const week = [];
        for (let d = 0; d < 7; d++) {
          const date = new Date(startDate);
          date.setDate(startDate.getDate() + w * 7 + d);
          const dateStr = date.toISOString().slice(0,10);
          week.push({ date: dateStr, count: dataMap[dateStr] || 0, future: dateStr > todayStr });
        }
        weeks.push(week);
      }
      g.innerHTML = weeks.map(w => `<div class="heatmap-week">${w.map(d => {
        if (d.future) return '<div class="heatmap-cell future"></div>';
        let l = '';
        if (d.count > 0) l = 'l1';
        if (d.count >= 10) l = 'l2';
        if (d.count >= 30) l = 'l3';
        if (d.count >= 50) l = 'l4';
        return `<div class="heatmap-cell ${l}" data-tip="${d.date}: ${d.count || 'No'} reviews"></div>`;
      }).join('')}</div>`).join('');
      const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
      let lm = -1, ml = [];
      weeks.forEach((w,i) => { const mo = parseInt(w[0].date.slice(5,7)) - 1; if (mo !== lm) { ml.push({m:months[mo],p:i}); lm = mo; }});
      m.innerHTML = ml.map((x,i) => `<span style="flex:${(ml[i+1]?.p||52)-x.p}">${x.m}</span>`).join('');
    }
    function renderTopDeck(data) {
      const c = document.getElementById('top-deck-list'), top6 = data.sort((a,b)=>b.reviews-a.reviews).slice(0,6);
      if(!top6.length){c.innerHTML='<div style="color:var(--text-muted)">No data</div>';return;}
      c.innerHTML = top6.map((d,i)=>`<div class="top-deck-item" data-tip="${d.reviews} reviews this week"><div class="rank">${i+1}</div><div class="deck-name">${d.name.includes('::')?d.name.split('::').pop():d.name}</div></div>`).join('');
    }
    function renderDecks(decks) {
      const c = document.getElementById('deck-list'), items = Object.values(decks).filter(d=>{
        const ma=d.mature||0,nw=d.new||0,le=d.total-ma-nw;
        return d.total>0 && (ma>0 || le>0);
      }).map(d=>{
        const ma=d.mature||0,nw=d.new||0,le=d.total-ma-nw;
        return {...d, ma, le, nw, learned: ma+le};
      }).sort((a,b)=>b.learned-a.learned);
      c.innerHTML = items.map(d=>{
        const name=d.name.includes('::')?d.name.split('::').pop():d.name;
        return`<div class="deck-item" data-tip="Mastered: ${d.ma}  Learning: ${d.le}  New: ${d.nw}"><div class="name" title="${d.name}">${name}</div><div class="stats">${d.learned}</div></div>`;
      }).join('');
    }
    async function init() {
      try {
        const r = await fetch('stats.json'), s = await r.json();
        renderBadges(s);
        const ls = getDaysAgo(s.last_study_date);
        document.getElementById('last-study-date').textContent = ls.formatted;
        document.getElementById('days-ago').textContent = ls.days;
        document.getElementById('streak-value').textContent = s.streak + 'd';
        renderWeekly(s.daily_deck_counts||{});
        renderHeatmap(s.heatmap_data);
        renderTopDeck(s.deck_reviews||[]);
        renderDecks(s.decks);
      } catch(e) { console.error(e); }
    }
    init();
  </script>
</body>
</html>
